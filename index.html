<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Barter Storage Dashboard</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --bg: #0f0f10;
      --panel: #171717;
      --muted: #9b9b9b;
      --card-hover: rgba(255,255,255,0.06);
      --shadow: 0 6px 18px rgba(0,0,0,0.6);
    }

    html,body { height: 100%; }
    body {
      margin:0;
      background: var(--bg);
      color: #eee;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .app-top {
      display:flex;
      align-items:center;
      gap:12px;
      justify-content:space-between;
      margin-bottom:1rem;
    }

    .app-title { font-weight:600; font-size:1.05rem; }

    /* tiers wrapper layout */
    .tiers-wrap {
      display:flex;
      gap:1rem;
      align-items:flex-start;
      flex-wrap:wrap;
    }

    .tier-column {
      background: var(--panel);
      border-radius:10px;
      padding:10px;
      min-width:220px;
      flex: 1 1 18%;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      max-height: 67vh;
      overflow: hidden;
    }

    /* sticky header inside column */
    .tier-header {
      position: sticky;
      top: 0;
      z-index: 2;
      padding:8px 10px;
      border-radius:8px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
      margin-bottom:8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-weight:600;
      font-size:0.95rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }

    .tier-items {
      overflow:auto;
      padding-right:8px;
    }

    .tier-items::-webkit-scrollbar { width:8px; height:8px; }
    .tier-items::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.04); border-radius:8px; }

    /* item card */
    .item-card {
      display:flex;
      gap:10px;
      align-items:center;
      padding:8px;
      border-radius:8px;
      margin-bottom:8px;
      cursor:pointer;
      transition: all .12s ease-in-out;
      background: rgba(255,255,255,0.02);
    }
    .item-card:hover { transform: translateY(-3px); background: var(--card-hover); }

    .item-img {
      width:42px;
      height:42px;
      border-radius:6px;
      object-fit:cover;
      background: rgba(255,255,255,0.03);
      flex: 0 0 42px;
    }

    .item-info {
      flex:1;
      display:flex;
      flex-direction:column;
      min-width:0;
    }

    .item-name { font-weight:600; font-size:0.88rem; line-height:1.05; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .item-location { font-size:0.75rem; color:var(--muted); margin-top:3px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .item-right {
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:4px;
      min-width:60px;
    }
    .item-qty { font-weight:700; font-size:0.92rem; color:#ddd; }

    /* subtle tier label colors in header left badge */
    .tier-badge {
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .tier-badge .dot {
      width:12px; height:12px; border-radius:3px; display:inline-block;
    }
    .t0 { background:#050505; }
    .t1 { background:#bdbdbd; }
    .t2 { background:#43a047; }
    .t3 { background:#1e88e5; }
    .t4 { background:#ffb300; }
    .t5 { background:#e53935; }

    /* header buttons */
    .top-actions button { margin-left:6px; }

    .dropdown-menu button {
      width: 100%;
      text-align: center;
    }

    #btnMobileFilter {
      display: none;
    }

    /* responsive columns: desktop 5, mid 3, small 1 */
    @media (max-width: 1200px) {
      .tier-column { flex: 0 0 30%; }
    }
    @media (max-width: 900px) {
      .tier-column { flex: 0 0 48%; }
    }
    @media (max-width: 600px) {
      .tiers-wrap { gap:0.75rem; }
      .tier-column { flex: 0 0 100%; max-height: none; }
      .tier-items { max-height: none; }
    }

    /* small tweaks for modals on mobile */
    @media (max-width:420px) {
      .modal-dialog { margin: 0.5rem; }
    }

    @media (max-width: 768px) {
      #btnMobileFilter {
        display: inline-block;
      }
    }

  </style>
</head>
<body class="p-3">
  <div class="container-fluid">
    <div class="app-top">
      <div class="d-flex gap-3 align-items-center">
        <div class="app-title">‚öì Barter Storage Dashboard</div>
        <small class="text-muted">(sticky tier headers, responsive columns)</small>
      </div>

      <!-- mobile layout: collapsible dropdown -->
      <div class="dropdown d-lg-flex">
        <button class="btn btn-outline-light btn-sm dropdown-toggle w-100" type="button" data-bs-toggle="dropdown">
          ‚öôÔ∏è Actions
        </button>
        <div class="dropdown-menu dropdown-menu-dark w-100 text-center">
          <button class="dropdown-item text-success" id="btnExchange">üîÑ Exchange</button>
          <button class="dropdown-item text-secondary" id="btnHistory">üïí History</button>
          <button class="dropdown-item text-primary" id="btnExportStorage">üíæ Export</button>
          <button class="dropdown-item text-warning" id="btnManageLocations">üì¶ Locations</button>
          <button class="dropdown-item text-danger" id="btnClearStorage">üßπ Clear</button>
          <button class="dropdown-item text-info" id="btnMobileFilter">üîç Filter</button>
        </div>
      </div>
    </div>

    <!-- tiers container (rendered by js) -->
    <div id="tiersContainer" class="tiers-wrap"></div>
  </div>

  <!-- Edit Modal (Multi-Storage Version) -->
  <div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">Edit Storage ‚Äî Multi Location</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <label class="form-label">Item Name</label>
            <input type="text" class="form-control form-control-sm" id="editItemName" readonly>
          </div>

          <div class="mb-2">
            <label class="form-label">Storages</label>
            <table class="table table-dark table-sm align-middle mb-2" id="storageTable">
              <thead>
                <tr>
                  <th>Location</th>
                  <th>Qty</th>
                  <th style="width:40px"></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>

            <button type="button" class="btn btn-sm btn-outline-success w-100" id="btnAddStorage">
              ‚ûï Add New Storage
            </button>
          </div>

          <div class="text-end mt-3">
            <button type="button" class="btn btn-success btn-sm" id="btnSaveStorage">üíæ Save</button>
            <button type="button" class="btn btn-danger btn-sm" id="btnDiscard">ü™ô Discard (T5)</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Exchange Modal (Refactored for multi-storage) -->
  <div class="modal fade" id="exchangeModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">Exchange Barter Item</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="exchangeForm">
            <div class="row mb-3">
              <div class="col">
                <label class="form-label">From Tier</label>
                <select class="form-select form-select-sm" id="fromTier">
                  <option value="1">T1</option>
                  <option value="2">T2</option>
                  <option value="3">T3</option>
                  <option value="4">T4</option>
                </select>
              </div>
              <div class="col">
                <label class="form-label">To Tier</label>
                <input type="text" class="form-control form-control-sm" id="toTier" readonly>
              </div>
            </div>

            <div class="mb-2">
              <label class="form-label">From Item</label>
              <select class="form-select form-select-sm" id="fromItem"></select>
            </div>
            <div class="mb-2">
              <label class="form-label">From Location</label>
              <select class="form-select form-select-sm" id="fromLocation"></select>
            </div>

            <div class="mb-2">
              <label class="form-label">To Item</label>
              <select class="form-select form-select-sm" id="toItem"></select>
            </div>
            <div class="mb-2">
              <label class="form-label">To Location</label>
              <!-- <input type="text" class="form-control form-control-sm" id="toLocation" placeholder="e.g. Lema Island"> -->
              <select class="form-select form-select-sm" id="toLocation"></select>
            </div>

            <div class="row mb-2">
              <div class="col">
                <label class="form-label">Qty From (Spent)</label>
                <input type="number" class="form-control form-control-sm" id="exchangeQtyFrom" min="1">
              </div>
              <div class="col">
                <label class="form-label">Qty To (Gained)</label>
                <input type="number" class="form-control form-control-sm" id="exchangeQtyTo" min="1">
              </div>
            </div>

            <div class="text-end">
              <button type="submit" class="btn btn-success btn-sm">üîÅ Execute Exchange</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div class="modal fade" id="historyModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">üìú Barter History Log</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <table class="table table-dark table-sm table-striped">
            <thead>
              <tr>
                <th>Time</th>
                <th>Action</th>
                <th>Detail</th>
              </tr>
            </thead>
            <tbody id="historyTable"></tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button id="btnExportHistory" class="btn btn-sm btn-warning">üì§ Export</button>
          <button id="btnClearHistory" class="btn btn-sm btn-danger">üßπ Clear</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Modal -->
  <div class="modal fade" id="filterModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">üì± Filter Items</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="mobileFilterForm">
            <div class="mb-2">
              <label class="form-label">Tier</label>
              <select class="form-select form-select-sm" id="filterTier">
                <option value="">All</option>
                <option value="1">Tier 1</option>
                <option value="2">Tier 2</option>
                <option value="3">Tier 3</option>
                <option value="4">Tier 4</option>
                <option value="5">Tier 5</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Location contains</label>
              <input type="text" class="form-control form-control-sm" id="filterLocation" placeholder="e.g. Iliya">
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="filterHasStock">
              <label class="form-check-label">Show only items with stock</label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-success btn-sm" id="btnApplyFilter">Apply</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Manage Locations Modal -->
  <div class="modal fade" id="locationsModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">Manage Cities / Islands</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <table class="table table-dark table-sm align-middle mb-2" id="locationsTable">
            <thead>
              <tr><th>Name</th><th style="width:40px"></th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="input-group input-group-sm mb-2">
            <input type="text" class="form-control" id="newLocationName" placeholder="New city/island name">
            <button class="btn btn-success" id="btnAddLocation">Add</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- logic file -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/barterLogic.js"></script>
</body>
</html>
