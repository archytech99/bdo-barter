<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Barter Storage Dashboard</title>

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="media/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="media/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="media/favicon-16x16.png">
  <link rel="manifest" href="media/site.webmanifest">

  <!-- Bootstrap -->
  <link href="css/bootstrap-5.3.3.min.css" rel="stylesheet">

  <!-- Custom styles -->
  <link href="css/styles.css" rel="stylesheet">
</head>
<body class="p-3">
  <div class="container-fluid">
    <div class="app-top">
      <div class="app-title-wrap">
        <div class="d-flex gap-3 align-items-center">
          <div class="app-title">Barter Storage Dashboard <span id="sumPriceBarter" class="text-muted">üì¶</span></div>
        </div>
      </div>

      <div class="top-actions d-flex align-items-center gap-2">
        <label class="btn btn-secondary btn-sm mb-0 import-btn">
          üì• Import
          <input type="file" id="importFile" accept=".json" hidden>
        </label>

        <div class="dropdown actions-dropdown">
          <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
            ‚öôÔ∏è Actions
          </button>
          <div class="dropdown-menu dropdown-menu-dark text-center">
            <button class="dropdown-item text-primary" id="btnExchange">üîÑ Exchange</button>
            <button class="dropdown-item text-info" id="btnEditPrices">üí∞ Prices</button>
            <button class="dropdown-item text-info" id="btnManageLocations">üö© Locations</button>
            <button class="dropdown-item text-secondary" id="btnHistory">üïí History</button>
            <button class="dropdown-item text-success" id="btnExportStorage">üíæ Export</button>
            <button class="dropdown-item text-danger" id="btnClearStorage">üßπ Clear</button>
            <button class="dropdown-item text-warning" id="btnMobileFilter">üîç Filter</button>
          </div>
        </div>
      </div>
    </div>


    <!-- tiers container (rendered by js) -->
    <div id="tiersContainer" class="tiers-wrap"></div>
  </div>

  <!-- Edit Modal (Multi-Storage Version) -->
  <div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">Edit Storage ‚Äî Multi Location</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <label class="form-label">Item Name</label>
            <input type="text" class="form-control form-control-sm" id="editItemName" readonly>
          </div>

          <div class="mb-2">
            <label class="form-label">Storages</label>
            <table class="table table-dark table-sm align-middle mb-2" id="storageTable">
              <thead>
                <tr>
                  <th>Location</th>
                  <th>Qty</th>
                  <th style="width:40px"></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>

            <button type="button" class="btn btn-sm btn-outline-success w-100" id="btnAddStorage">
              ‚ûï Add New Storage
            </button>
          </div>

          <div class="text-end mt-3">
            <button type="button" class="btn btn-success btn-sm" id="btnSaveStorage">üíæ Save</button>
            <button type="button" class="btn btn-danger btn-sm" id="btnDiscard">ü™ô Discard (T5)</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Exchange Modal (Refactored for multi-storage) -->
  <div class="modal fade" id="exchangeModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">Exchange Barter Item</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="exchangeForm">
            <div class="row mb-3">
              <div class="col">
                <label class="form-label">From Tier</label>
                <select class="form-select form-select-sm" id="fromTier">
                  <option value="1">T1</option>
                  <option value="2">T2</option>
                  <option value="3">T3</option>
                  <option value="4">T4</option>
                </select>
              </div>
              <div class="col">
                <label class="form-label">To Tier</label>
                <input type="text" class="form-control form-control-sm" id="toTier" readonly>
              </div>
            </div>

            <div class="mb-2">
              <label class="form-label">From Item</label>
              <select class="form-select form-select-sm" id="fromItem"></select>
            </div>
            <div class="mb-2">
              <label class="form-label">From Location</label>
              <select class="form-select form-select-sm" id="fromLocation"></select>
            </div>

            <div class="mb-2">
              <label class="form-label">To Item</label>
              <select class="form-select form-select-sm" id="toItem"></select>
            </div>
            <div class="mb-2">
              <label class="form-label">To Location</label>
              <!-- <input type="text" class="form-control form-control-sm" id="toLocation" placeholder="e.g. Lema Island"> -->
              <select class="form-select form-select-sm" id="toLocation"></select>
            </div>

            <div class="row mb-2">
              <div class="col">
                <label class="form-label">Qty From (Spent)</label>
                <input type="number" class="form-control form-control-sm" id="exchangeQtyFrom" min="1">
              </div>
              <div class="col">
                <label class="form-label">Qty To (Gained)</label>
                <input type="number" class="form-control form-control-sm" id="exchangeQtyTo" min="1">
              </div>
            </div>

            <div class="text-end">
              <button type="submit" class="btn btn-success btn-sm">üîÅ Execute Exchange</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div class="modal fade" id="historyModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">üìú Barter History Log</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <table class="table table-dark table-sm table-striped">
            <thead>
              <tr>
                <th>Time</th>
                <th>Action</th>
                <th>Detail</th>
              </tr>
            </thead>
            <tbody id="historyTable"></tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button id="btnClearHistory" class="btn btn-sm btn-danger">üßπ Clear</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Modal -->
  <div class="modal fade" id="filterModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">üì± Filter Items</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="mobileFilterForm">
            <div class="mb-2">
              <label class="form-label">Tier</label>
              <select class="form-select form-select-sm" id="filterTier">
                <option value="1">Tier 1</option>
                <option value="2">Tier 2</option>
                <option value="3">Tier 3</option>
                <option value="4">Tier 4</option>
                <option value="5">Tier 5</option>
                <option value="" selected>All</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Location contains</label>
              <input type="text" class="form-control form-control-sm" id="filterLocation" placeholder="e.g. Iliya">
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="filterHasStock">
              <label class="form-check-label">Show only items with stock</label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-success btn-sm" id="btnApplyFilter">Apply</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Manage Locations Modal -->
  <div class="modal fade" id="locationsModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">Manage Cities / Islands</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <table class="table table-dark table-sm align-middle mb-2" id="locationsTable">
            <thead>
              <tr><th>Name</th><th style="width:40px"></th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="input-group input-group-sm mb-2">
            <input type="text" class="form-control" id="newLocationName" placeholder="New city/island name">
            <button class="btn btn-success" id="btnAddLocation">Add</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Prices Modal -->
  <div class="modal fade" id="priceModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">Edit Tier Prices</h5>
          <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <label class="form-label">Tier 1 Price</label>
          <input id="priceT1" type="number" class="form-control mb-2" readonly>

          <label class="form-label">Tier 2 Price</label>
          <input id="priceT2" type="number" class="form-control mb-2" readonly>

          <label class="form-label">Tier 3 Price</label>
          <input id="priceT3" type="number" class="form-control mb-2">

          <label class="form-label">Tier 4 Price</label>
          <input id="priceT4" type="number" class="form-control mb-2">

          <label class="form-label">Tier 5 Price</label>
          <input id="priceT5" type="number" class="form-control mb-2">
        </div>

        <div class="modal-footer">
          <button class="btn btn-primary" id="btnSavePrices">Save</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Footer -->
  <footer class="container-fluid">
    <div class="app-footer">
      <div>¬© <span id="currentYear"></span> Barter Storage Dashboard</div>
      <div class="text-muted">
        v2.1 ‚Äî Data stored locally ‚Ä¢ 
        <a href="mailto:archytech99@gmail.com">Contact</a> ‚Ä¢ 
        <a href="https://buymeacoffee.com/ariefbp" target="_blank" rel="noopener noreferrer">Buy Me a Coffee</a>
      </div>
    </div>
  </footer>

  <script>
    // set current year
    const yEl = document.getElementById('currentYear');
    if (yEl) yEl.textContent = new Date().getFullYear();
  </script>

  <!-- logic file -->
  <script src="js/bootstrap-5.3.3.bundle.min.js"></script>
  <script src="js/barterLogic.js"></script>
</body>
</html>
